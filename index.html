<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <title>Kevin Strakerjahn Networks &amp; Automation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Favicon (Tab-Icon) -->
    <link rel="icon" type="image/png" href="Logos/logo.png">

    <style>
        :root {
            --primary: #0b74ff;
            --primary-soft: rgba(11, 116, 255, 0.08);
            --bg: #f5f7fb;
            --card-bg: #ffffff;
            --border: #e1e4ec;
            --text-main: #1f2933;
            --text-muted: #6b7280;
            --radius-lg: 14px;
        }

        * {
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            color: var(--text-main);
            line-height: 1.6;
        }

        img {
            max-width: 100%;
            height: auto;
            display: block;
        }

        .page {
            max-width: 1100px;
            margin: 2rem auto 3rem;
            padding: 0 1rem;
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            box-shadow: 0 10px 30px rgba(15, 23, 42, 0.06);
            padding: 1.75rem 1.9rem 2.1rem;
            border: 1px solid var(--border);
        }

        /* ---------- HEADER / BILD ---------- */

        .header {
            margin-bottom: 1.5rem;
        }

        .logo-wrapper {
            width: 100%;
        }

        .logo-wrapper img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            object-fit: cover;
        }

        /* ---------- EINLEITUNG ---------- */

        .intro {
            margin-bottom: 1.75rem;
        }

        .intro h1 {
            font-size: 1.5rem;
            margin: 0 0 0.4rem;
        }

        .intro p {
            margin: 0.1rem 0;
            color: var(--text-muted);
            font-size: 0.95rem;
        }

        /* ---------- AKTUELLES-TABELLE ---------- */

        .aktuelles-section {
            margin-top: 1.5rem;
        }

        .aktuelles-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            gap: 0.75rem;
            margin-bottom: 0.6rem;
            flex-wrap: wrap;
        }

        .aktuelles-header h2 {
            margin: 0;
            font-size: 1.1rem;
        }

        .aktuelles-header span {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .aktuelles-loading,
        .aktuelles-error,
        .aktuelles-empty {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin: 0.4rem 0 0.6rem;
        }

        .aktuelles-loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 999px;
            border: 2px solid rgba(148, 163, 184, 0.5);
            border-top-color: var(--primary);
            animation: spin 0.7s linear infinite;
            vertical-align: middle;
            margin-right: 0.4rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .table-wrapper {
            width: 100%;
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: #f9fafb;
        }

        table.aktuelles-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            min-width: 520px;
        }

        table.aktuelles-table thead {
            background: #eef1f6;
        }

        table.aktuelles-table th,
        table.aktuelles-table td {
            padding: 0.55rem 0.7rem;
            border-bottom: 1px solid #e5e7eb;
            text-align: left;
            vertical-align: top;
        }

        table.aktuelles-table th {
            font-weight: 600;
            color: #374151;
            white-space: nowrap;
        }

        table.aktuelles-table tbody tr:last-child td {
            border-bottom: none;
        }

        table.aktuelles-table tbody tr:hover {
            background: #f3f4f6;
        }

        .small-text {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .tag-list {
            display: flex;
            gap: 0.25rem;
            flex-wrap: wrap;
        }

        .tag {
            font-size: 0.75rem;
            background: #e5e7eb;
            color: #374151;
            padding: 0.1rem 0.45rem;
            border-radius: 999px;
        }

        .aktuelles-link {
            font-size: 0.85rem;
            color: var(--primary);
            text-decoration: underline;
            text-underline-offset: 2px;
        }

        .aktuelles-link:hover {
            color: #0649a8;
        }

        /* ---------- FOOTER ---------- */

        footer {
            margin-top: 1.2rem;
            font-size: 0.85rem;
            color: var(--text-muted);
            border-top: 1px solid var(--border);
            padding-top: 0.75rem;
        }

        .footer-buttons {
            display: flex;
            justify-content: center;
            gap: 2.5rem;
            margin-top: 0.2rem;
            margin-bottom: 0.1rem;
        }

        .footer-link {
            font-size: 1.05rem;
            font-weight: 600;
            color: var(--text-muted);
            text-decoration: underline;
            text-underline-offset: 3px;
            cursor: pointer;
        }

        .footer-link:hover {
            color: var(--text-main);
        }

        /* ---------- MOBILE ---------- */
        @media (max-width: 600px) {
            .page {
                margin: 1.25rem auto 2rem;
                padding: 0 0.75rem;
            }

            .card {
                padding: 1.25rem 1.1rem 1.8rem;
                border-radius: 12px;
            }

            .logo-wrapper img {
                border-radius: 8px;
            }

            .intro h1 {
                font-size: 1.25rem;
            }

            .footer-buttons {
                gap: 1.8rem;
            }
        }
    </style>
</head>
<body>

<div class="page">
    <div class="card">

        <!-- Vollbreites Bild -->
        <header class="header">
            <div class="logo-wrapper">
                <!-- Pfad von der Startseite aus -->
                <img src="Logos/logo_name.jpeg" alt="Kevin Strakerjahn Networks &amp; Automation">
            </div>
        </header>

        <!-- Einleitung -->
        <section class="intro">
            <h1>Networks &amp; Automation für Windenergie und Industrie</h1>
            <p>
                Planung, Einrichtung und Betreuung von Netzwerken, Routern und Monitoring-Lösungen –
                mit Fokus auf Windparks und technische Betriebsführung.
            </p>
            <p>
                Unten finden Sie eine Übersicht aktueller Themen und Projekte.
            </p>
        </section>

        <!-- Aktuelles (Tabelle aus /aktuelles/*/intro.txt) -->
        <section class="aktuelles-section" aria-label="Aktuelle Themen und Projekte">
            <div class="aktuelles-header">
                <h2>Aktuelles</h2>
                <span id="aktuelles-meta">Wird geladen …</span>
            </div>

            <div id="aktuelles-loading" class="aktuelles-loading">
                <span class="aktuelles-loading-spinner"></span>
                <span>Aktuelle Einträge werden geladen …</span>
            </div>
            <div id="aktuelles-error" class="aktuelles-error" style="display:none;"></div>
            <div id="aktuelles-empty" class="aktuelles-empty" style="display:none;">
                Derzeit liegen keine Einträge im Bereich „Aktuelles“ vor.
            </div>

            <div class="table-wrapper" id="aktuelles-table-wrapper" style="display:none;">
                <table class="aktuelles-table" aria-describedby="aktuelles-meta">
                    <thead>
                        <tr>
                            <th>Datum</th>
                            <th>Thema</th>
                            <th>Kategorie</th>
                            <th>Beschreibung</th>
                            <th>Details</th>
                        </tr>
                    </thead>
                    <tbody id="aktuelles-tbody">
                    </tbody>
                </table>
            </div>
        </section>

        <footer>
            <div class="footer-buttons">
                <a class="footer-link" href="/">Start</a>
                <a class="footer-link" href="/kontakt/">Kontakt</a>
                <a class="footer-link" href="/impressum/">Impressum</a>
                <a class="footer-link" href="/datenschutz/">Datenschutz</a>
            </div>
        </footer>

    </div>
</div>

<script>
    // GitHub-API-Basis für /aktuelles im Repo
    const GITHUB_AKTUELLES_API =
        "https://api.github.com/repos/KESAA98/netteck.de/contents/aktuelles";

    function formatDate(dateStr) {
        if (!dateStr) return "";
        const d = new Date(dateStr);
        if (isNaN(d)) return dateStr;
        return d.toLocaleDateString("de-DE", {
            day: "2-digit",
            month: "2-digit",
            year: "numeric"
        });
    }

    function sortByDate(entries) {
        return entries.slice().sort((a, b) => {
            const da = a.date ? new Date(a.date) : null;
            const db = b.date ? new Date(b.date) : null;

            if (da && db && !isNaN(da) && !isNaN(db)) {
                return db - da; // neueste zuerst
            }
            if (da && !db) return -1;
            if (!da && db) return 1;
            return (a.slug || "").localeCompare(b.slug || "");
        });
    }

    async function fetchFolders() {
        const res = await fetch(GITHUB_AKTUELLES_API);
        if (!res.ok) {
            throw new Error("Fehler beim Laden von /aktuelles (Status " + res.status + ")");
        }
        const json = await res.json();
        return json.filter(entry => entry.type === "dir");
    }

    async function fetchIntroForSlug(slug) {
        const url = GITHUB_AKTUELLES_API + "/" + encodeURIComponent(slug) + "/intro.txt";
        const res = await fetch(url);
        if (!res.ok) {
            throw new Error("intro.txt für " + slug + " nicht gefunden (Status " + res.status + ")");
        }

        const meta = await res.json();
        if (!meta.download_url) {
            throw new Error("Keine download_url für intro.txt in " + slug);
        }

        const textRes = await fetch(meta.download_url);
        if (!textRes.ok) {
            throw new Error("Download von intro.txt für " + slug + " fehlgeschlagen (Status " + textRes.status + ")");
        }

        const raw = await textRes.text();
        let data;
        try {
            data = JSON.parse(raw);
        } catch (e) {
            throw new Error("intro.txt in " + slug + " enthält kein gültiges JSON");
        }

        if (!data.slug) {
            data.slug = slug;
        }

        return data;
    }

    function renderAktuelles(entries) {
        const tbody = document.getElementById("aktuelles-tbody");
        const wrapper = document.getElementById("aktuelles-table-wrapper");
        const meta = document.getElementById("aktuelles-meta");
        const emptyEl = document.getElementById("aktuelles-empty");

        tbody.innerHTML = "";

        if (!entries || entries.length === 0) {
            wrapper.style.display = "none";
            emptyEl.style.display = "block";
            meta.textContent = "Aktuell keine Einträge vorhanden.";
            return;
        }

        wrapper.style.display = "block";
        emptyEl.style.display = "none";

        const sorted = sortByDate(entries);

        meta.textContent =
            sorted.length + " Eintrag" + (sorted.length === 1 ? "" : "e") + " im Überblick.";

        sorted.forEach(entry => {
            const tr = document.createElement("tr");

            const dateCell = document.createElement("td");
            dateCell.textContent = entry.date ? formatDate(entry.date) : "";
            tr.appendChild(dateCell);

            const titleCell = document.createElement("td");
            const titleText = entry.title || entry.slug || "Aktueller Eintrag";
            const titleDiv = document.createElement("div");
            titleDiv.textContent = titleText;
            titleCell.appendChild(titleDiv);

            if (entry.comment) {
                const small = document.createElement("div");
                small.className = "small-text";
                small.textContent = entry.comment;
                titleCell.appendChild(small);
            }

            tr.appendChild(titleCell);

            const catCell = document.createElement("td");
            const cat = entry.category || "Projekt";
            const catDiv = document.createElement("div");
            catDiv.textContent = cat;
            catCell.appendChild(catDiv);

            if (Array.isArray(entry.tags) && entry.tags.length > 0) {
                const tagsDiv = document.createElement("div");
                tagsDiv.className = "tag-list";
                entry.tags.forEach(tag => {
                    const t = document.createElement("span");
                    t.className = "tag";
                    t.textContent = tag;
                    tagsDiv.appendChild(t);
                });
                catCell.appendChild(tagsDiv);
            }

            tr.appendChild(catCell);

            const descCell = document.createElement("td");
            const teaser = entry.teaser || "";
            const desc = teaser || "";
            descCell.textContent = desc;
            tr.appendChild(descCell);

            const linkCell = document.createElement("td");
            const slug = entry.slug || "";
            if (slug) {
                const a = document.createElement("a");
                a.href = "/aktuelles/" + encodeURIComponent(slug) + "/";
                a.className = "aktuelles-link";
                a.textContent = "Öffnen";
                linkCell.appendChild(a);
            } else {
                linkCell.textContent = "-";
            }
            tr.appendChild(linkCell);

            tbody.appendChild(tr);
        });
    }

    async function initAktuelles() {
        const loadingEl = document.getElementById("aktuelles-loading");
        const errorEl = document.getElementById("aktuelles-error");
        const emptyEl = document.getElementById("aktuelles-empty");
        const wrapper = document.getElementById("aktuelles-table-wrapper");

        loadingEl.style.display = "block";
        errorEl.style.display = "none";
        emptyEl.style.display = "none";
        wrapper.style.display = "none";

        try {
            const folders = await fetchFolders();
            if (!folders || folders.length === 0) {
                loadingEl.style.display = "none";
                emptyEl.style.display = "block";
                return;
            }

            const introPromises = folders.map(folder =>
                fetchIntroForSlug(folder.name).catch(err => {
                    console.warn("Fehler bei intro für", folder.name, err);
                    return null;
                })
            );

            const introData = await Promise.all(introPromises);
            const validEntries = introData.filter(Boolean);

            loadingEl.style.display = "none";
            renderAktuelles(validEntries);
        } catch (e) {
            console.error(e);
            loadingEl.style.display = "none";
            errorEl.textContent = "Die aktuellen Einträge konnten nicht geladen werden. Bitte später erneut versuchen.";
            errorEl.style.display = "block";
        }
    }

    document.addEventListener("DOMContentLoaded", initAktuelles);
</script>

</body>
</html>
